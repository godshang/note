# I/O多路复用技术的区别

I/O多路复用有三种实现方式：select、poll、epoll。

select的缺点：

* 单个进程打开的FD是有限制的，通过FD——SETSIZE设置，默认1024
* 每次调用select，都需要吧FD集合从用户态拷贝到内核态，这个开销在FD很多时会很大
* 对socket扫描是线性扫描，采用轮训方式，效率较低（高并发时）

poll与select相比，只是没有fd的限制，其它基本一样。

poll的缺点：

* 每次调用poll，都需要吧FD集合从用户态拷贝到内核态，这个开销在FD很多时会很大
* 对socket扫描是线性扫描，采用轮训的方法，效率较低

epoll的缺点：

* 只能工作在linux下

## select/poll/epoll之间的区别

|            | select             | poll             | epoll                                             |
| ---------- | ------------------ | ---------------- | ------------------------------------------------- |
| 数据结构 | bitmap             | 数组           | 红黑树                                         |
| 最大连接数 | 1024               | 无上限        | 无上限                                         |
| fd拷贝   | 每次调用select拷贝 | 每次调用poll拷贝 | fd首次调用epoll_ctl拷贝，每次调用epoll_wait不拷贝 |
| 工作效率 | 轮询：O(n)      | 轮询：O(n)    | 回调：O(1)                                     |

## epoll LT与ET模式的区别

* epoll有EPOLLLT和EPOLLET两种触发模式，LT是默认的模式，ET是“高速”模式。
* LT模式下，只要这个fd还有数据可读，每次 epoll_wait都会返回它的事件，提醒用户程序去操作。
* ET模式下，它只会提示一次，直到下次再有数据流入之前都不会再提示了，无论fd中是否还有数据可读。所以在ET模式下，read一个fd的时候一定要把它的buffer读完，或者遇到EAGAIN错误。

